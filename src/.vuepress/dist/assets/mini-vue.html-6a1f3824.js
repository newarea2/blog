import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as c,c as i,a as n,b as s,f as t,d as p}from"./app-72775176.js";const l={},u=n("h1",{id:"vueå®˜æ–¹æ•™ç¨‹ç¬”è®°-å°¤é›¨æºªæ‰‹å†™mini-vue",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#vueå®˜æ–¹æ•™ç¨‹ç¬”è®°-å°¤é›¨æºªæ‰‹å†™mini-vue","aria-hidden":"true"},"#"),s(" [Vueå®˜æ–¹æ•™ç¨‹ç¬”è®°]- å°¤é›¨æºªæ‰‹å†™mini-vue")],-1),r={href:"https://juejin.cn/post/6909247394904702984",title:"https://juejin.cn/post/6909247394904702984",target:"_blank",rel:"noopener noreferrer"},k=n("p",null,"ğŸ”¥è¿™å‘¨æˆ‘çœ‹äº†çœ‹äº†å°¤å¤§ç¥äº²æ‰‹å†™çš„miniç‰ˆVue3ï¼Œç¬”è®°å¦‚ä¸‹è¯·å¤§å®¶æŒ‡æ­£ã€‚",-1),d={href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.vuemastery.com%2Fcourses%2Fvue3-deep-dive-with-evan-you",title:"https://www.vuemastery.com/courses/vue3-deep-dive-with-evan-you",target:"_blank",rel:"noopener noreferrer"},v=p(`<figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/02.jpg" alt="image-20201230111207968" tabindex="0" loading="lazy"><figcaption>image-20201230111207968</figcaption></figure><h1 id="âš¡ï¸å…³æ³¨å…¬ä¼—å·ã€å‰ç«¯å¤§ç­è½¦ã€‘-å›å¤-ã€mini-vueã€‘ç´¢å–å®Œæ•´ä»£ç " tabindex="-1"><a class="header-anchor" href="#âš¡ï¸å…³æ³¨å…¬ä¼—å·ã€å‰ç«¯å¤§ç­è½¦ã€‘-å›å¤-ã€mini-vueã€‘ç´¢å–å®Œæ•´ä»£ç " aria-hidden="true">#</a> âš¡ï¸å…³æ³¨å…¬ä¼—å·ã€å‰ç«¯å¤§ç­è½¦ã€‘ å›å¤ ã€mini-vueã€‘ç´¢å–å®Œæ•´ä»£ç </h1><h2 id="ä¸€ã€æ•´ä½“å·¥ä½œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€æ•´ä½“å·¥ä½œæµç¨‹" aria-hidden="true">#</a> ä¸€ã€æ•´ä½“å·¥ä½œæµç¨‹</h2><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/04.gif" alt="Kapture 2020-12-10 at 16.13.53.gif" tabindex="0" loading="lazy"><figcaption>Kapture 2020-12-10 at 16.13.53.gif</figcaption></figure><ol><li>ç¼–è¯‘å™¨å°†è§†å›¾æ¨¡æ¿ç¼–è¯‘ä¸ºæ¸²æŸ“å‡½æ•°</li><li>æ•°æ®å“åº”æ¨¡å—å°†æ•°æ®å¯¹è±¡åˆå§‹åŒ–ä¸ºå“åº”å¼æ•°æ®å¯¹è±¡</li><li>è§†å›¾æ¸²æŸ“ <ol><li>RenderPhase ï¼š æ¸²æŸ“æ¨¡å—ä½¿ç”¨æ¸²æŸ“å‡½æ•°æ ¹æ®åˆå§‹åŒ–æ•°æ®ç”Ÿæˆè™šæ‹ŸDom</li><li>MountPhase ï¼š åˆ©ç”¨è™šæ‹ŸDomåˆ›å»ºè§†å›¾é¡µé¢Html</li><li>PatchPhaseï¼šæ•°æ®æ¨¡å‹ä¸€æ—¦å˜åŒ–æ¸²æŸ“å‡½æ•°å°†å†æ¬¡è¢«è°ƒç”¨ç”Ÿæˆæ–°çš„è™šæ‹ŸDomï¼Œç„¶ååšDom Diffæ›´æ–°è§†å›¾Html</li></ol></li></ol><h2 id="äºŒã€ä¸‰å¤§æ¨¡å—çš„åˆ†å·¥" tabindex="-1"><a class="header-anchor" href="#äºŒã€ä¸‰å¤§æ¨¡å—çš„åˆ†å·¥" aria-hidden="true">#</a> äºŒã€ä¸‰å¤§æ¨¡å—çš„åˆ†å·¥</h2><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/05.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><ul><li>æ•°æ®å“åº”å¼æ¨¡å—</li><li>ç¼–è¯‘å™¨</li><li>æ¸²æŸ“å‡½æ•°</li></ul><h3 id="_1-æ•°æ®å“åº”å¼æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_1-æ•°æ®å“åº”å¼æ¨¡å—" aria-hidden="true">#</a> 1. æ•°æ®å“åº”å¼æ¨¡å—</h3><p>æä¾›åˆ›å»ºä¸€åˆ‡æ•°æ®å˜åŒ–éƒ½æ˜¯å¯ä»¥è¢«ç›‘å¬çš„å“åº”å¼å¯¹è±¡çš„æ–¹æ³•ã€‚<img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/06.gif" alt="Kapture 2020-12-10 at 11.47.59.gif" loading="lazy"></p><h3 id="_2-ç¼–è¯‘æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#_2-ç¼–è¯‘æ¨¡å—" aria-hidden="true">#</a> 2. ç¼–è¯‘æ¨¡å—</h3><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/07.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>å°†htmlæ¨¡æ¿ç¼–è¯‘ä¸ºæ¸²æŸ“å‡½æ•°</p><p>è¿™ä¸ªç¼–è¯‘è¿‡ç¨‹å¯ä»¥åœ¨ä¸€ä¸‹ä¸¤ä¸ªæ—¶åˆ»æ‰§è¡Œ</p><ul><li>æµè§ˆå™¨è¿è¡Œæ—¶ (runtime)</li><li>Vueé¡¹ç›®æ‰“åŒ…ç¼–è¯‘æ—¶ (compile time)</li></ul><h3 id="_3-æ¸²æŸ“å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_3-æ¸²æŸ“å‡½æ•°" aria-hidden="true">#</a> 3. æ¸²æŸ“å‡½æ•°</h3><p>æ¸²æŸ“å‡½æ•°é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªå‘¨æœŸå°†è§†å›¾æ¸²æŸ“åˆ°é¡µé¢ä¸Š<img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/08.png" alt="image.png" loading="lazy"></p><ul><li>Render Phase</li><li>Mount Phase</li><li>Patch Phase</li></ul><h2 id="ä¸‰ã€mvvmåŸå‹-mockç‰ˆ" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€mvvmåŸå‹-mockç‰ˆ" aria-hidden="true">#</a> ä¸‰ã€MVVMåŸå‹(Mockç‰ˆ)</h2><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/09.gif" alt="MVVMåŸç†" tabindex="0" loading="lazy"><figcaption>MVVMåŸç†</figcaption></figure><p>MVVMæ¡†æ¶å…¶å®å°±æ˜¯åœ¨åŸå…ˆçš„Viewå’ŒModelä¹‹é—´å¢åŠ äº†ä¸€ä¸ªVMå±‚å®Œæˆä»¥ä¸‹å·¥ä½œã€‚å®Œæˆæ•°æ®ä¸è§†å›¾çš„ç›‘å¬ã€‚æˆ‘ä»¬è¿™ä¸€æ­¥å…ˆå†™ä¸€ä¸ªMockç‰ˆæœ¬ã€‚å…¶å®å°±æ˜¯å…ˆé’ˆå¯¹å›ºå®šçš„è§†å›¾å’Œæ•°æ®æ¨¡å‹å®ç°ç›‘å¬ã€‚</p><h3 id="_1-æ¥å£å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_1-æ¥å£å®šä¹‰" aria-hidden="true">#</a> 1. æ¥å£å®šä¹‰</h3><p>æˆ‘ä»¬MVVMçš„æ¡†æ¶æ¥å£å’ŒVue3ä¸€æ¨¡ä¸€æ ·ã€‚</p><p>åˆå§‹åŒ–éœ€è¦ç¡®å®š</p><ul><li>è§†å›¾æ¨¡æ¿</li><li>æ•°æ®æ¨¡å‹</li><li>æ¨¡å‹è¡Œä¸º - æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›clickçš„æ—¶å€™æ•°æ®æ¨¡å‹çš„messageä¼šä¼šå€’åºæ’åˆ—ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// è§†å›¾</span>
  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
  &lt;input v-model=&quot;message&quot;/&gt;
  &lt;button @click=&#39;click&#39;&gt;{{message}}&lt;/button&gt;
  </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ•°æ®åŠ«æŒ</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Hello Vue 3!!&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> ret <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// è§¦å‘å‡½æ•°å“åº”</span>
          <span class="token function">effective</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">click</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>message <span class="token operator">=</span> state<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> click <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>
<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ç¨‹åºéª¨æ¶" tabindex="-1"><a class="header-anchor" href="#_2-ç¨‹åºéª¨æ¶" aria-hidden="true">#</a> 2. ç¨‹åºéª¨æ¶</h3><p>ç¨‹åºæ‰§è¡Œè¿‡ç¨‹å¤§æ¦‚å¦‚å›¾ï¼š</p><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/10.gif" alt="render-proxy" tabindex="0" loading="lazy"><figcaption>render-proxy</figcaption></figure><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> Vue <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ç¼–è¯‘è¿‡ç¨‹</span>
    <span class="token keyword">const</span> <span class="token function-variable function">compile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">template</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> dom</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// ç”Ÿæˆæ¸²æŸ“å‡½æ•°</span>
    <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">compile</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">mount</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// å®ç°setupå‡½æ•°</span>
        <span class="token keyword">const</span> setupResult <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ•°æ®å“åº”æ›´æ–°è§†å›¾</span>
        <span class="token function-variable function">effective</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">render</span><span class="token punctuation">(</span>setupResult<span class="token punctuation">,</span> dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">render</span><span class="token punctuation">(</span>setupResult<span class="token punctuation">,</span> dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-ç¼–è¯‘æ¸²æŸ“å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_3-ç¼–è¯‘æ¸²æŸ“å‡½æ•°" aria-hidden="true">#</a> 3. ç¼–è¯‘æ¸²æŸ“å‡½æ•°</h3><p>MVVMæ¡†æ¶ä¸­çš„æ¸²æŸ“å‡½æ•°æ˜¯ä¼šé€šè¿‡è§†å›¾æ¨¡æ¿çš„ç¼–è¯‘å»ºç«‹çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç¼–è¯‘å‡½æ•°</span>
<span class="token comment">// è¾“å…¥å€¼ä¸ºè§†å›¾æ¨¡æ¿</span>
<span class="token keyword">const</span> <span class="token function-variable function">compile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">template</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//æ¸²æŸ“å‡½æ•°</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">observed<span class="token punctuation">,</span> dom</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  	<span class="token comment">// æ¸²æŸ“è¿‡ç¨‹</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç®€å•çš„è¯´å°±æ˜¯å¯¹è§†å›¾æ¨¡æ¿è¿›è¡Œè§£æå¹¶ç”Ÿæˆæ¸²æŸ“å‡½æ•°ã€‚</p><p>å¤§æ¦‚è¦å¤„ç†ä»¥ä¸‹ä¸‰ä»¶äº‹</p><ul><li><p>ç¡®å®šå“ªäº›å€¼éœ€è¦æ ¹æ®æ•°æ®æ¨¡å‹æ¸²æŸ“</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// &lt;button&gt;{{message}}&lt;/button&gt;</span>
<span class="token comment">// å°†æ•°æ®æ¸²æŸ“åˆ°è§†å›¾</span>
button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span>
button<span class="token punctuation">.</span>innerText <span class="token operator">=</span> observed<span class="token punctuation">.</span>message
dom<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç»‘å®šæ¨¡å‹äº‹ä»¶</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// &lt;button @click=&#39;click&#39;&gt;{{message}}&lt;/button&gt;</span>
<span class="token comment">// ç»‘å®šæ¨¡å‹äº‹ä»¶</span>
button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> config<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>observed<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ç¡®å®šå“ªäº›è¾“å…¥é¡¹éœ€è¦åŒå‘ç»‘å®š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// &lt;input v-model=&quot;message&quot;/&gt;</span>
<span class="token comment">// åˆ›å»ºkeyupäº‹ä»¶ç›‘å¬è¾“å…¥é¡¹ä¿®æ”¹</span>
input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;keyup&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  observed<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>å®Œæ•´çš„ä»£ç </p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">compile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">template</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">observed<span class="token punctuation">,</span> dom</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token comment">// é‡æ–°æ¸²æŸ“</span>
    <span class="token keyword">let</span> input <span class="token operator">=</span> dom<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">)</span>
        input<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> observed<span class="token punctuation">.</span>message<span class="token punctuation">)</span>

        input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;keyup&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            observed<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        dom<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> button <span class="token operator">=</span> dom<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>button<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;create button&#39;</span><span class="token punctuation">)</span>
        button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> config<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>observed<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        dom<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    button<span class="token punctuation">.</span>innerText <span class="token operator">=</span> observed<span class="token punctuation">.</span>message
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å››ã€æ•°æ®å“åº”å®ç°" tabindex="-1"><a class="header-anchor" href="#å››ã€æ•°æ®å“åº”å®ç°" aria-hidden="true">#</a> å››ã€æ•°æ®å“åº”å®ç°</h2><p>Vueæ™®éèµ°çš„å°±æ˜¯æ•°æ®åŠ«æŒæ–¹å¼ã€‚ä¸åŒçš„åœ¨äºä½¿ç”¨DefinePropertyè¿˜æ˜¯Proxyã€‚ä¹Ÿå°±æ˜¯ä¸€æ¬¡ä¸€ä¸ªå±æ€§åŠ«æŒè¿˜æ˜¯ä¸€æ¬¡åŠ«æŒä¸€ä¸ªå¯¹è±¡ã€‚å½“ç„¶åè€…æ¯”å‰è€…å¬ç€å°±æ˜æ˜¾æœ‰ä¼˜åŠ¿ã€‚è¿™ä¹Ÿå°±æ˜¯Vue3çš„å“åº”å¼åŸç†ã€‚</p><p>Proxy/Reflectæ˜¯åœ¨ES2015è§„èŒƒä¸­åŠ å…¥çš„ï¼ŒProxyå¯ä»¥æ›´å¥½çš„æ‹¦æˆªå¯¹è±¡è¡Œä¸ºï¼ŒReflectå¯ä»¥æ›´ä¼˜é›…çš„æ“çºµå¯¹è±¡ã€‚ ä¼˜åŠ¿åœ¨äº</p><ul><li>é’ˆå¯¹æ•´ä¸ªå¯¹è±¡å®šåˆ¶ è€Œä¸æ˜¯å¯¹è±¡çš„æŸä¸ªå±æ€§ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸éœ€è¦å¯¹keysè¿›è¡Œéå†ã€‚</li><li>æ”¯æŒæ•°ç»„,è¿™ä¸ªDefinePropertyä¸å…·å¤‡ã€‚è¿™æ ·å°±çœå»äº†é‡è½½æ•°ç»„æ–¹æ³•è¿™æ ·çš„Hackè¿‡ç¨‹ã€‚</li><li>Proxy çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æœ‰ 13 ç§æ‹¦æˆªæ–¹æ³•ï¼Œè¿™æ¯”èµ· Object.defineProperty() è¦æ›´åŠ ä¸°å¯Œ</li><li>Proxy ä½œä¸ºæ–°æ ‡å‡†å—åˆ°æµè§ˆå™¨å‚å•†çš„é‡ç‚¹å…³æ³¨å’Œæ€§èƒ½ä¼˜åŒ–ï¼Œç›¸æ¯”ä¹‹ä¸‹ Object.defineProperty() æ˜¯ä¸€ä¸ªå·²æœ‰çš„è€æ–¹æ³•</li><li>å¯ä»¥é€šè¿‡é€’å½’æ–¹ä¾¿çš„è¿›è¡Œå¯¹è±¡åµŒå¥—ã€‚</li></ul><p>è¯´äº†è¿™ä¹ˆå¤šæˆ‘ä»¬å…ˆæ¥ä¸€ä¸ªå°ä¾‹å­</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">getting </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">setting </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
obj<span class="token punctuation">.</span>abc <span class="token operator">=</span> <span class="token number">132</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·å†™å¦‚æœä½ ä¿®æ”¹objä¸­çš„å€¼ï¼Œå°±ä¼šæ‰“å°å‡ºæ¥ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœå¯¹è±¡è¢«ä¿®æ”¹å°±ä¼šå¾—çš„è¢«å“åº”ã€‚</p><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/11.jpg" alt="image-20200713122621925" tabindex="0" loading="lazy"><figcaption>image-20200713122621925</figcaption></figure><p>å½“ç„¶æˆ‘ä»¬éœ€è¦çš„å“åº”å°±æ˜¯é‡æ–°æ›´æ–°è§†å›¾ä¹Ÿå°±æ˜¯é‡æ–°è¿è¡Œrenderæ–¹æ³•ã€‚</p><p>é¦–å…ˆåˆ¶é€ ä¸€ä¸ªæŠ½è±¡çš„æ•°æ®å“åº”å‡½æ•°</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// å®šä¹‰å“åº”å‡½æ•°</span>
<span class="token keyword">let</span> effective
observed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ret <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>
    <span class="token comment">// è§¦å‘å‡½æ•°å“åº”</span>
    <span class="token function">effective</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ret
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨åˆå§‹åŒ–çš„æ—¶å€™æˆ‘ä»¬è®¾ç½®å“åº”åŠ¨ä½œä¸ºæ¸²æŸ“è§†å›¾</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span>
<span class="token comment">// è®¾ç½®å“åº”åŠ¨ä½œä¸ºæ¸²æŸ“è§†å›¾</span>
<span class="token function-variable function">effective</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">render</span><span class="token punctuation">(</span>observed<span class="token punctuation">,</span> dom<span class="token punctuation">)</span>
<span class="token function">render</span><span class="token punctuation">(</span>observed<span class="token punctuation">,</span> dom<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-è§†å›¾å˜åŒ–çš„ç›‘å¬" tabindex="-1"><a class="header-anchor" href="#_1-è§†å›¾å˜åŒ–çš„ç›‘å¬" aria-hidden="true">#</a> 1. è§†å›¾å˜åŒ–çš„ç›‘å¬</h3><p>æµè§ˆå™¨è§†å›¾çš„å˜åŒ–,ä¸»è¦ä½“ç°åœ¨å¯¹è¾“å…¥é¡¹å˜åŒ–çš„ç›‘å¬ä¸Šï¼Œæ‰€ä»¥åªéœ€è¦é€šè¿‡ç»‘å®šç›‘å¬äº‹ä»¶å°±å¯ä»¥äº†ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;keyup&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-å®Œæ•´çš„ä»£ç " tabindex="-1"><a class="header-anchor" href="#_2-å®Œæ•´çš„ä»£ç " aria-hidden="true">#</a> 2. å®Œæ•´çš„ä»£ç </h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
      <span class="token keyword">const</span> Vue <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function">createApp</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// ç¼–è¯‘è¿‡ç¨‹</span>
          <span class="token keyword">const</span> <span class="token function-variable function">compile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">template</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> dom</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// é‡æ–°æ¸²æŸ“</span>
            dom<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;keyup&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              content<span class="token punctuation">.</span>state<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            input<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> content<span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            dom<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">let</span> button <span class="token operator">=</span> dom<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> content<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            button<span class="token punctuation">.</span>innerText <span class="token operator">=</span> content<span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
            dom<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>

          <span class="token comment">// ç”Ÿæˆæ¸²æŸ“å‡½æ•°</span>
          <span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">compile</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">mount</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">const</span> setupResult <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token function-variable function">effective</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">render</span><span class="token punctuation">(</span>setupResult<span class="token punctuation">,</span> dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token function">render</span><span class="token punctuation">(</span>setupResult<span class="token punctuation">,</span> dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// å®šä¹‰å“åº”å‡½æ•°</span>
      <span class="token keyword">let</span> effective<span class="token punctuation">;</span>
      <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// è§†å›¾</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
                &lt;input v-model=&quot;message&quot;/&gt;
                &lt;button @click=&#39;click&#39;&gt;{{message}}&lt;/button&gt;
            </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// æ•°æ®åŠ«æŒ</span>
          <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>
            <span class="token punctuation">{</span>
              <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;Hello Vue 3!!&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> ret <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// è§¦å‘å‡½æ•°å“åº”</span>
                <span class="token function">effective</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token keyword">const</span> <span class="token function-variable function">click</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            state<span class="token punctuation">.</span>message <span class="token operator">=</span> state<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> click <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>
      <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äº”ã€-è§†å›¾æ¸²æŸ“è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#äº”ã€-è§†å›¾æ¸²æŸ“è¿‡ç¨‹" aria-hidden="true">#</a> äº”ã€ è§†å›¾æ¸²æŸ“è¿‡ç¨‹</h2><blockquote><p>Dom =&gt; virtual DOM =&gt; render functions</p></blockquote><h3 id="_1-ä»€ä¹ˆæ˜¯dom-ã€document-object-model" tabindex="-1"><a class="header-anchor" href="#_1-ä»€ä¹ˆæ˜¯dom-ã€document-object-model" aria-hidden="true">#</a> 1. ä»€ä¹ˆæ˜¯Dom ã€Document Object Model</h3><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/12.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>HTMLåœ¨æµè§ˆå™¨ä¸­ä¼šæ˜ å°„ä¸ºä¸€äº›åˆ—èŠ‚ç‚¹ï¼Œæ–¹ä¾¿æˆ‘ä»¬å»è°ƒç”¨ã€‚</p><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/13.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="_2-ä»€ä¹ˆæ˜¯è™šæ‹Ÿdom" tabindex="-1"><a class="header-anchor" href="#_2-ä»€ä¹ˆæ˜¯è™šæ‹Ÿdom" aria-hidden="true">#</a> 2. ä»€ä¹ˆæ˜¯è™šæ‹ŸDom</h3><p>Domä¸­èŠ‚ç‚¹ä¼—å¤šï¼Œç›´æ¥æŸ¥è¯¢å’Œæ›´æ–°Domæ€§èƒ½è¾ƒå·®ã€‚</p><blockquote><p>A way of representing the actual DOM with JavaScript Objects. ç”¨JSå¯¹è±¡é‡æ–°è¡¨ç¤ºå®é™…çš„Dom</p></blockquote><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/14.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="_3-ä»€ä¹ˆæ˜¯æ¸²æŸ“å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_3-ä»€ä¹ˆæ˜¯æ¸²æŸ“å‡½æ•°" aria-hidden="true">#</a> 3. ä»€ä¹ˆæ˜¯æ¸²æŸ“å‡½æ•°</h3><p>åœ¨Vueä¸­æˆ‘ä»¬é€šè¿‡å°†è§†å›¾æ¨¡æ¿(template)ç¼–è¯‘ä¸ºæ¸²æŸ“å‡½æ•°(render function)å†è½¬åŒ–ä¸ºè™šæ‹ŸDom</p><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/15.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="_4-é€šè¿‡domdiffé«˜æ•ˆæ›´æ–°è§†å›¾" tabindex="-1"><a class="header-anchor" href="#_4-é€šè¿‡domdiffé«˜æ•ˆæ›´æ–°è§†å›¾" aria-hidden="true">#</a> 4. é€šè¿‡DomDiffé«˜æ•ˆæ›´æ–°è§†å›¾</h3><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/16.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="_5-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_5-æ€»ç»“" aria-hidden="true">#</a> 5. æ€»ç»“</h3><p>ä¸¾ä¸ªæ —å­ğŸŒ° è™šæ‹ŸDomå’ŒDomå°±åƒå¤§æ¥¼å’Œå¤§æ¥¼è®¾è®¡å›¾ä¹‹é—´çš„å…³ç³»ã€‚</p><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/17.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>å‡è®¾ä½ è¦åœ¨29å±‚æ·»åŠ ä¸€ä¸ªå¨æˆ¿ âŒ æ‹†é™¤æ•´ä¸ª29å±‚ï¼Œé‡æ–°å»ºè®¾ âœ…å…ˆç»˜åˆ¶è®¾è®¡å›¾ï¼Œæ‰¾å‡ºæ–°æ—§ç»“æ„ä¸åŒç„¶åå»ºè®¾</p><h2 id="å…­ã€å®ç°æ¸²æŸ“å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å…­ã€å®ç°æ¸²æŸ“å‡½æ•°" aria-hidden="true">#</a> å…­ã€å®ç°æ¸²æŸ“å‡½æ•°</h2><p>åœ¨Vueä¸­æˆ‘ä»¬é€šè¿‡å°†è§†å›¾æ¨¡æ¿(template)ç¼–è¯‘ä¸ºæ¸²æŸ“å‡½æ•°(render function)å†è½¬åŒ–ä¸ºè™šæ‹ŸDom</p><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/15.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>æ¸²æŸ“æµç¨‹é€šå¸¸ä¼šåˆ†ä¸ºä¸‰å„éƒ¨åˆ†:</p>`,80),m={href:"https://link.juejin.cn/?target=https%3A%2F%2Fvue-next-template-explorer.netlify.app%2F",title:"https://vue-next-template-explorer.netlify.app/",target:"_blank",rel:"noopener noreferrer"},b=p(`<figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/18.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>RenderPhase ï¼š æ¸²æŸ“æ¨¡å—ä½¿ç”¨æ¸²æŸ“å‡½æ•°æ ¹æ®åˆå§‹åŒ–æ•°æ®ç”Ÿæˆè™šæ‹ŸDom</li><li>MountPhase ï¼š åˆ©ç”¨è™šæ‹ŸDomåˆ›å»ºè§†å›¾é¡µé¢Html</li><li>PatchPhaseï¼šæ•°æ®æ¨¡å‹ä¸€æ—¦å˜åŒ–æ¸²æŸ“å‡½æ•°å°†å†æ¬¡è¢«è°ƒç”¨ç”Ÿæˆæ–°çš„è™šæ‹ŸDomï¼Œç„¶ååšDom Diffæ›´æ–°è§†å›¾Html</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">mount</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> setupResult <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> render <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>setupResult<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> isMounted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> prevSubTree<span class="token punctuation">;</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMounted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// mount</span>
        isMounted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> subTree <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>setupResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        prevSubTree <span class="token operator">=</span> subTree<span class="token punctuation">;</span>
        <span class="token function">mountElement</span><span class="token punctuation">(</span>subTree<span class="token punctuation">,</span> dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// update</span>
        <span class="token keyword">const</span> subTree <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>setupResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">diff</span><span class="token punctuation">(</span>prevSubTree<span class="token punctuation">,</span> subTree<span class="token punctuation">)</span><span class="token punctuation">;</span>
        prevSubTree <span class="token operator">=</span> subTree<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-render-phase" tabindex="-1"><a class="header-anchor" href="#_1-render-phase" aria-hidden="true">#</a> 1.Render Phase</h3><p>æ¸²æŸ“æ¨¡å—ä½¿ç”¨æ¸²æŸ“å‡½æ•°æ ¹æ®åˆå§‹åŒ–æ•°æ®ç”Ÿæˆè™šæ‹ŸDom</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">String</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span>
      <span class="token string">&quot;button&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">onClick</span><span class="token operator">:</span> content<span class="token punctuation">.</span>click<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string">&quot;click&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-mount-phase" tabindex="-1"><a class="header-anchor" href="#_2-mount-phase" aria-hidden="true">#</a> 2. Mount Phase</h3><p>åˆ©ç”¨è™šæ‹ŸDomåˆ›å»ºè§†å›¾é¡µé¢Html</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mountElement</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> container</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ¸²æŸ“æˆçœŸå®çš„ dom èŠ‚ç‚¹</span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å¤„ç† props</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> vnode<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> val <span class="token operator">=</span> vnode<span class="token punctuation">.</span>props<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token function">patchProp</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è¦å¤„ç† children</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vnode<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">mountElement</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">insert</span><span class="token punctuation">(</span><span class="token function">createText</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// æ’å…¥åˆ°è§†å›¾å†…</span>
  <span class="token function">insert</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-patch-phase-dom-diff" tabindex="-1"><a class="header-anchor" href="#_3-patch-phase-dom-diff" aria-hidden="true">#</a> 3. Patch Phase(Dom diff)</h3><p>æ•°æ®æ¨¡å‹ä¸€æ—¦å˜åŒ–æ¸²æŸ“å‡½æ•°å°†å†æ¬¡è¢«è°ƒç”¨ç”Ÿæˆæ–°çš„è™šæ‹ŸDomï¼Œç„¶ååšDom Diffæ›´æ–°è§†å›¾Html</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patchProp</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> prevValue<span class="token punctuation">,</span> nextValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// onClick</span>
  <span class="token comment">// 1. å¦‚æœå‰é¢2ä¸ªå€¼æ˜¯ on çš„è¯</span>
  <span class="token comment">// 2. å°±è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªäº‹ä»¶</span>
  <span class="token comment">// 3. on åé¢çš„å°±æ˜¯å¯¹åº”çš„äº‹ä»¶å</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;on&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> eventName <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> nextValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextValue <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> nextValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> nextValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡DomDiff - é«˜æ•ˆæ›´æ–°è§†å›¾</p><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/16.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/19.png" alt="image-20201230104838657" tabindex="0" loading="lazy"><figcaption>image-20201230104838657</figcaption></figure><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">diff</span><span class="token punctuation">(</span><span class="token parameter">v1<span class="token punctuation">,</span> v2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. å¦‚æœ tag éƒ½ä¸ä¸€æ ·çš„è¯ï¼Œç›´æ¥æ›¿æ¢</span>
  <span class="token comment">// 2. å¦‚æœ tag ä¸€æ ·çš„è¯</span>
  <span class="token comment">//    1. è¦æ£€æµ‹ props å“ªäº›æœ‰å˜åŒ–</span>
  <span class="token comment">//    2. è¦æ£€æµ‹ children  -ã€‹ ç‰¹åˆ«å¤æ‚çš„</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> oldProps<span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> oldChildren <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> v1<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">props</span><span class="token operator">:</span> newProps<span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> newChildren <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> v2<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>v1<span class="token punctuation">.</span>tag <span class="token operator">!==</span> v2<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v1<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span><span class="token function">createElement</span><span class="token punctuation">(</span>v2<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token punctuation">(</span>v2<span class="token punctuation">.</span>el <span class="token operator">=</span> v1<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¯¹æ¯” props</span>
    <span class="token comment">// 1. æ–°çš„èŠ‚ç‚¹ä¸ç­‰äºè€èŠ‚ç‚¹çš„å€¼ -&gt; ç›´æ¥èµ‹å€¼</span>
    <span class="token comment">// 2. æŠŠè€èŠ‚ç‚¹é‡Œé¢æ–°èŠ‚ç‚¹ä¸å­˜åœ¨çš„ key éƒ½åˆ é™¤æ‰</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>newProps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> oldProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">patchProp</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> oldProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> newProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// éå†è€èŠ‚ç‚¹ -ã€‹ æ–°èŠ‚ç‚¹é‡Œé¢æ²¡æœ‰çš„è¯ï¼Œé‚£ä¹ˆéƒ½åˆ é™¤æ‰</span>
      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>oldProps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">patchProp</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> oldProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å¯¹æ¯” children</span>

    <span class="token comment">// \bnewChildren -&gt; string</span>
    <span class="token comment">// oldChildren -&gt; string   oldChildren -&gt; array</span>

    <span class="token comment">// newChildren -&gt; array</span>
    <span class="token comment">// oldChildren -&gt; string   oldChildren -&gt; array</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> newChildren <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> oldChildren <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newChildren <span class="token operator">!==</span> oldChildren<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setText</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> newChildren<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æŠŠä¹‹å‰çš„å…ƒç´ éƒ½æ›¿æ¢æ‰</span>
        v1<span class="token punctuation">.</span>el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> newChildren<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> oldChildren <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ¸…ç©ºä¹‹å‰çš„æ•°æ®</span>
        n1<span class="token punctuation">.</span>el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// æŠŠæ‰€æœ‰çš„ children mount å‡ºæ¥</span>
        newChildren<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">mountElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// a, b, c, d, e -&gt; new</span>
        <span class="token comment">// a1,b1,c1,d1 -&gt; old</span>
        <span class="token comment">// å¦‚æœ new çš„å¤šçš„è¯ï¼Œé‚£ä¹ˆåˆ›å»ºä¸€ä¸ªæ–°çš„</span>

        <span class="token comment">// a, b, c -&gt; new</span>
        <span class="token comment">// a1,b1,c1,d1 -&gt; old</span>
        <span class="token comment">// å¦‚æœ old çš„å¤šçš„è¯ï¼Œé‚£ä¹ˆæŠŠå¤šçš„éƒ½åˆ é™¤æ‰</span>
        <span class="token keyword">const</span> length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length<span class="token punctuation">,</span> oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> oldVnode <span class="token operator">=</span> oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> newVnode <span class="token operator">=</span> newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token comment">// å¯ä»¥ååˆ†å¤æ‚</span>
          <span class="token function">diff</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> newVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldChildren<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// è¯´æ˜è€çš„èŠ‚ç‚¹å¤š</span>
          <span class="token comment">// éƒ½åˆ é™¤æ‰</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> oldChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">remove</span><span class="token punctuation">(</span>oldChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newChildren<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// è¯´æ˜ new çš„èŠ‚ç‚¹å¤š</span>
          <span class="token comment">// é‚£ä¹ˆéœ€è¦åˆ›å»ºå¯¹åº”çš„èŠ‚ç‚¹</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newChildren<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">mountElement</span><span class="token punctuation">(</span>newChildren<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¸ƒã€ç¼–è¯‘å™¨åŸç†" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€ç¼–è¯‘å™¨åŸç†" aria-hidden="true">#</a> ä¸ƒã€ç¼–è¯‘å™¨åŸç†</h2><blockquote><p>è¿™ä¸ªåœ°æ–¹å°¤å¤§ç¥å¹¶æ²¡æœ‰å®ç° åç»­ç„¶å”ä¼šç»™å¤§å®¶æä¾›ä¸€ä¸ªè¶…ç®€æ´çš„ç‰ˆæœ¬ è¿™ä¸ªç« èŠ‚æˆ‘ä»¬ä¸»è¦çœ‹çœ‹compileè¿™ä¸ªåŠŸèƒ½ã€‚</p></blockquote><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e70cd358dc244b169a5e6482b861eaab~tplv-k3u1fbpfcp-zoom-1.image" alt="compiler" tabindex="0" loading="lazy"><figcaption>compiler</figcaption></figure><p>ä¸Šæ–‡å·²ç»è¯´è¿‡ç¼–è¯‘å‡½æ•°çš„åŠŸèƒ½</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ç¼–è¯‘å‡½æ•°</span>
<span class="token comment">// è¾“å…¥å€¼ä¸ºè§†å›¾æ¨¡æ¿</span>
<span class="token keyword">const</span> <span class="token function-variable function">compile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">template</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//æ¸²æŸ“å‡½æ•°</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">observed<span class="token punctuation">,</span> dom</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  	<span class="token comment">// æ¸²æŸ“è¿‡ç¨‹</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç®€å•çš„è¯´å°±æ˜¯</p><ul><li>è¾“å…¥ï¼šè§†å›¾æ¨¡æ¿</li><li>è¾“å‡ºï¼šæ¸²æŸ“å‡½æ•°</li></ul><p>ç»†åˆ†èµ·æ¥è¿˜å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªä¸ªå°æ­¥éª¤</p><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/21.jpg" alt="Snip20200713_17" tabindex="0" loading="lazy"><figcaption>Snip20200713_17</figcaption></figure>`,25),g=n("li",null,[n("p",null,"Parse æ¨¡æ¿å­—ç¬¦ä¸² -> AST(Abstract Syntax Treee)æŠ½è±¡è¯­æ³•æ ‘")],-1),f=n("li",null,[n("p",null,"Transform è½¬æ¢æ ‡è®° è­¬å¦‚ v-bind v-if v-forçš„è½¬æ¢")],-1),h=p(`<p>Generate AST -&gt; æ¸²æŸ“å‡½æ•°</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//  æ¨¡æ¿å­—ç¬¦ä¸² -&gt; AST(Abstract Syntax Treee)æŠ½è±¡è¯­æ³•æ ‘</span>
<span class="token keyword">let</span> ast <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>
<span class="token comment">// è½¬æ¢å¤„ç† è­¬å¦‚ v-bind v-if v-forçš„è½¬æ¢</span>
ast <span class="token operator">=</span> <span class="token function">transfer</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span>
<span class="token comment">// AST -&gt; æ¸²æŸ“å‡½æ•°</span>
<span class="token keyword">return</span> <span class="token function">generator</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span>
å¤åˆ¶ä»£ç 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨çº¿ç‰ˆçš„VueTemplateExploreræ„Ÿå—ä¸€ä¸‹</p>`,3),y={href:"https://link.juejin.cn/?target=https%3A%2F%2Fvue-next-template-explorer.netlify.com%2F",title:"https://vue-next-template-explorer.netlify.com/",target:"_blank",rel:"noopener noreferrer"},w=n("figure",null,[n("img",{src:"https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/22.jpg",alt:"image-20200713150630150",tabindex:"0",loading:"lazy"}),n("figcaption",null,"image-20200713150630150")],-1),j={href:"https://juejin.im/post/5d9dbfb4e51d4577f7061978#heading-1",title:"https://juejin.im/post/5d9dbfb4e51d4577f7061978#heading-1",target:"_blank",rel:"noopener noreferrer"},q=p(`<h3 id="_1-parseè§£æå™¨" tabindex="-1"><a class="header-anchor" href="#_1-parseè§£æå™¨" aria-hidden="true">#</a> 1. Parseè§£æå™¨</h3><p>è§£æå™¨çš„å·¥ä½œåŸç†å…¶å®å°±æ˜¯ä¸€è¿ä¸²çš„æ­£åˆ™åŒ¹é…ã€‚</p><p>æ¯”å¦‚ï¼š</p><p>æ ‡ç­¾å±æ€§çš„åŒ¹é…</p><ul><li><p>class=&quot;title&quot;</p></li><li><p>class=&#39;title&#39;</p></li><li><p>class=title</p></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> attr <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([a-zA-Z_:][-a-zA-Z0-9_:.]*)=(&quot;([^&quot;]*)&quot;|&#39;([^&#39;]*)&#39;|([^\\s&quot;&#39;=&lt;&gt;\`]+)</span><span class="token regex-delimiter">/</span></span>

<span class="token string">&quot;class=abc&quot;</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// output</span>
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token string">&quot;class=abc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">&quot;class=abc&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">groups</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">]</span>

<span class="token string">&quot;class=&#39;abc&#39;&quot;</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// output</span>
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token string">&quot;class=&#39;abc&#39;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&#39;abc&#39;&quot;</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">&quot;class=&#39;abc&#39;&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">groups</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªç­‰å®ç°çš„æ—¶å€™å†ä»”ç»†è®²ã€‚å¯ä»¥å‚è€ƒä¸€ä¸‹æ–‡ç« ã€‚</p>`,7),x={href:"https://juejin.im/post/5d9c16686fb9a04e320a54c0#heading-5",title:"https://juejin.im/post/5d9c16686fb9a04e320a54c0#heading-5",target:"_blank",rel:"noopener noreferrer"},_=p(`<p>é‚£å¯¹äºæˆ‘ä»¬çš„é¡¹ç›®æ¥è®²å°±å¯ä»¥å†™æˆè¿™ä¸ªæ ·å­</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// &lt;input v-model=&quot;message&quot;/&gt;</span>
<span class="token comment">// &lt;button @click=&#39;click&#39;&gt;{{message}}&lt;/button&gt;</span>
<span class="token comment">// è½¬æ¢åçš„ASTè¯­æ³•æ ‘</span>
<span class="token keyword">const</span> <span class="token function-variable function">parse</span> <span class="token operator">=</span> <span class="token parameter">template</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;input&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;v-model&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">exp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&#39;message&#39;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;button&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;@click&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">exp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&#39;message&#39;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">content</span><span class="token operator">:</span><span class="token string">&#39;{{message}}&#39;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-transformè½¬æ¢å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-transformè½¬æ¢å¤„ç†" aria-hidden="true">#</a> 2. Transformè½¬æ¢å¤„ç†</h3><p>å‰ä¸€æ®µçŸ¥è¯†åšçš„æ˜¯æŠ½è±¡è¯­æ³•æ ‘ï¼Œå¯¹äºVue3æ¨¡æ¿çš„ç‰¹åˆ«è½¬æ¢å°±æ˜¯åœ¨è¿™é‡Œè¿›è¡Œã€‚</p><p>æ¯”å¦‚ï¼švForã€vOn</p><p>åœ¨Vueä¸‰ç§ä¹Ÿä¼šç»†è‡´çš„åˆ†ä¸ºä¸¤ä¸ªå±‚çº§è¿›è¡Œå¤„ç†</p><ul><li><p>compile-core æ ¸å¿ƒç¼–è¯‘é€»è¾‘</p><ul><li><p>AST-Parser</p></li><li><p>åŸºç¡€ç±»å‹è§£æ v-for ã€v-on</p><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/23.jpg" alt="image-20200713183256931" tabindex="0" loading="lazy"><figcaption>image-20200713183256931</figcaption></figure></li></ul></li><li><p>compile-dom é’ˆå¯¹æµè§ˆå™¨çš„ç¼–è¯‘é€»è¾‘</p><ul><li><p>v-html</p></li><li><p>v-model</p></li><li><p>v-clock</p><figure><img src="https://blog-1320825986.cos.ap-nanjing.myqcloud.com/20230525/24.jpg" alt="image-20200713183210079" tabindex="0" loading="lazy"><figcaption>image-20200713183210079</figcaption></figure></li></ul></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">transfer</span> <span class="token operator">=</span> <span class="token parameter">ast</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;input&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;model&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">exp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&#39;message&#39;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token string">&#39;button&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">exp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&#39;message&#39;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&#39;message&#39;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-generateç”Ÿæˆæ¸²æŸ“å™¨" tabindex="-1"><a class="header-anchor" href="#_3-generateç”Ÿæˆæ¸²æŸ“å™¨" aria-hidden="true">#</a> 3. Generateç”Ÿæˆæ¸²æŸ“å™¨</h3><p>ç”Ÿæˆå™¨å…¶å®å°±æ˜¯æ ¹æ®è½¬æ¢åçš„ASTè¯­æ³•æ ‘ç”Ÿæˆæ¸²æŸ“å‡½æ•°ã€‚å½“ç„¶é’ˆå¯¹ç›¸åŒçš„è¯­æ³•æ ‘ä½ å¯ä»¥æ¸²æŸ“æˆä¸åŒç»“æœã€‚æ¯”å¦‚buttonä½ å¸Œæœ›æ¸²æŸ“æˆ buttonè¿˜æ˜¯ä¸€ä¸ªsvgçš„æ–¹å—å°±çœ‹ä½ çš„å–œæ¬¢äº†ã€‚è¿™ä¸ªå°±å«åšè‡ªå®šä¹‰æ¸²æŸ“å™¨ã€‚è¿™é‡Œæˆ‘ä»¬å…ˆç®€å•å†™ä¸€ä¸ªå›ºå®šçš„Domçš„æ¸²æŸ“å™¨å ä½ã€‚åˆ°åé¢å®ç°çš„æ—¶å€™æˆ‘åœ¨å±•å¼€å¤„ç†ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">generator</span> <span class="token operator">=</span> <span class="token parameter">ast</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">observed<span class="token punctuation">,</span> dom</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// é‡æ–°æ¸²æŸ“</span>
    <span class="token keyword">let</span> input <span class="token operator">=</span> dom<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;input&#39;</span><span class="token punctuation">)</span>
        input<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> observed<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
        input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;keyup&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            observed<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        dom<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> button <span class="token operator">=</span> dom<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>button<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;create button&#39;</span><span class="token punctuation">)</span>
        button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;button&#39;</span><span class="token punctuation">)</span>
        button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> config<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>observed<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        dom<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    button<span class="token punctuation">.</span>innerText <span class="token operator">=</span> observed<span class="token punctuation">.</span>message
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11),V={href:"https://juejin.cn/post/6911897255087702030",target:"_blank",rel:"noopener noreferrer"};function P(C,A){const a=o("ExternalLinkIcon");return c(),i("div",null,[u,n("p",null,[s("ä¸Šå‘¨å‘äº†Â "),n("a",r,[s("ã€Vue3å®˜æ–¹æ•™ç¨‹ã€‘ğŸ„ä¸‡å­—ç¬”è®° | åŒæ­¥å¯¼å­¦è§†é¢‘"),t(a)]),s("Â 1050èµ")]),k,n("p",null,[n("a",d,[s("ã€åŸç‰ˆè§†é¢‘ã€‘"),t(a)])]),v,n("blockquote",null,[n("p",null,[n("a",m,[s("vue-next-template-explorer.netlify.app/"),t(a)])])]),b,n("ul",null,[g,f,n("li",null,[h,n("p",null,[n("a",y,[s("vue-next-template-explorer.netlify.com/"),t(a)])])])]),w,n("blockquote",null,[n("p",null,[n("a",j,[s("ç¼–è¯‘å‡½æ•°è§£æ"),t(a)])])]),q,n("p",null,[n("a",x,[s("ASTè§£æå™¨å®æˆ˜"),t(a)])]),_,n("p",null,[s("è½¬è½½è‡ª"),n("a",V,[s("[Vueå®˜æ–¹æ•™ç¨‹ç¬”è®°]- å°¤é›¨æºªæ‰‹å†™mini-vue"),t(a)])])])}const T=e(l,[["render",P],["__file","mini-vue.html.vue"]]);export{T as default};
