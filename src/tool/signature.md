# 数字前面与数字证书

RSA 加密过程是公钥加密、私钥解密，而[数字签名](https://so.csdn.net/so/search?q=%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D&spm=1001.2101.3001.7020)、数字证书都是私钥签名（可以理解为加密），公钥签名验证（可以理解为解密）。公钥和私钥都可以用来加密或解密，只要能保证用 A 加密，就用 B 解密即可，至于 A 是公钥还是私钥，可以根据不同的用途而定。

例如：

**如果你想把某个消息秘密的发给某人，那你就可以用他的公钥加密**

因为只有他知道他的私钥，所以这消息也就只有他本人能解开，于是你就达到了你的目的。

**如果你想发布一个公告，需要一个手段来证明这确实是你本人发的，而不是其他人冒名顶替的**

那你可以在你的公告开头或者结尾附上一段用你的私钥加密的内容（例如说就是你公告正文的一段话），那所有其他人都可以用你的公钥来解密，看看解出来的内容是不是相符的。

如果是的话，那就说明这公告确实是你发的，因为只有你的公钥才能解开你的私钥加密的内容，而其他人是拿不到你的私钥的。

**数字签名**

数字签名无非就两个目的：

**证明这消息是你发的**

上面 2 关于“公告”那段内容，已经证明这消息是你发的。

**证明这消息内容确实是完整的，也就是没有经过任何形式的篡改（包括替换、缺少、新增）**

把你公告的原文做一次哈希（ md5 或者 sha1 ），然后用你的私钥加密这段哈希作为签名，并一起公布出去。

当别人收到你的公告时，他可以用你的公钥解密你的签名，如果解密成功，并且解密出来的哈希值确实和你的公告原文做哈希处理后是一致的，那就证明了两点：这消息确实是你发的，而且内容是完整的。

**1、RSA 公钥解密，私钥解密过程**

1.1、鲍勃有两把钥匙，一把是公钥，另一把是私钥。

![](https://image.newarea.site/2024-02-18-23-40-01.png)

1.2、鲍勃把公钥送给他的朋友们----帕蒂、道格、苏珊----每人一把。

![](https://image.newarea.site/2024-02-18-23-40-02.png)

1.3、苏珊要给鲍勃写一封保密的信。她写完后用鲍勃的公钥加密，就可以达到保密的效果。

![](https://image.newarea.site/2024-02-18-23-40-03.png)

1.4、鲍勃收信后，用私钥解密，就看到了信件内容。这里要强调的是，只要鲍勃的私钥不泄露，这封信就是安全的，即使落在别人手里，也无法解密。

![](https://image.newarea.site/2024-02-18-23-40-04.png)

**2、数字签名**

2.1、鲍勃给苏珊回信，决定采用"数字签名"。

他写完后先用 Hash 函数（哈希算法），生成信件的摘要（digest）。

![](https://image.newarea.site/2024-02-18-23-40-05.png)

2.2、然后，鲍勃使用私钥，对这个摘要加密，生成"数字签名"（signature）。

![](https://image.newarea.site/2024-02-18-23-40-06.png)

2.3、鲍勃将这个签名，附在信件下面，一起发给苏珊。

![](https://image.newarea.site/2024-02-18-23-40-07.png)

2.4、苏珊收信后，取下数字签名，用鲍勃的公钥解密，得到信件的摘要。由此证明，这封信确实是鲍勃发出的。

2.5、苏珊再对信件本身使用 Hash 函数，将得到的结果与上一步得到的摘要进行对比。如果两者一致，就证明这封信未被修改过。

![](https://image.newarea.site/2024-02-18-23-40-08.png)

**3、数字证书**

3.1、复杂的情况出现了。

道格想欺骗苏珊，他偷偷使用了苏珊的电脑，用自己的公钥换走了鲍勃的公钥。此时，苏珊实际拥有的是道格的公钥，但是还以为这是鲍勃的公钥。因此，道格就可以冒充鲍勃，用自己的私钥做成"数字签名"，写信给苏珊，让苏珊用假的鲍勃公钥进行解密。

3.2、后来，苏珊感觉不对劲，发现自己无法确定公钥是否真的属于鲍勃。她想到了一个办法，要求鲍勃去找"证书中心"（certificate authority，简称 CA），为公钥做认证。

证书中心用自己的私钥，对鲍勃的公钥和一些相关信息一起加密，生成"[数字证书](https://so.csdn.net/so/search?q=%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6&spm=1001.2101.3001.7020)"（Digital Certificate）。

3.3、鲍勃拿到数字证书以后，就可以放心了。以后再给苏珊写信，只要在签名的同时，再附上数字证书就行了。

3.4、苏珊收信后，用 CA 的公钥解开数字证书，就可以拿到鲍勃真实的公钥了，然后就能证明"数字签名"是否真的是鲍勃签的。

![](https://image.newarea.site/2024-02-18-23-40-09.png)

**4、示例**

下面，我们看一个应用"数字证书"的实例：HTTPS 协议：HTTPS = HTTP + SSL。

HTTP 协议是明文传输的，也就是说当数据包使用 HTTP 协议进行传输的时候，如果数据包中途被截下来了，那么里面的数据（明文）就会完全暴露。

因此，如果数据包里面存放着用户的帐号和密码，就可以认为用户的帐号和密码已经泄漏了。 

HTTPS 协议则使用了 SSL 对数据进行加密，即使数据被拦截下来，如果没有解密的密钥，也无法得知用户的数据。

**客户端向服务器发送数据：**

因为服务器的公钥是公开的，所以客户端很容易就能获取得到服务器的公钥。客户端利用服务器的公钥加密数据，这些数据只有存储在服务器的私钥才能解密。   

**服务器向客户端发送数据：**

服务器在向客户端发送数据的时候，除了用私钥加密以外，还要生成一个数字签名。

**什么是数字签名？**

服务器会使用 hash 函数对向客户端发送的数据生成一个摘要（digest），然后用服务器的私钥加密这一个 digest，得到的就是数字签名了。

当客户端拿到服务器发送的数据后，对数据使用相同的 hash 函数加密一遍，和用公钥解密的 digest 进行对比，如果核对一致则说明中途传输的数据没有被篡改。

考虑第三种情况，如何确保你拿到的服务器公钥确实是正确的服务器的公钥呢？

即有人将其他的服务器的公钥给了客户端，使客户端误以为自己在跟正确的服务器进行交互。（攻击者可以在代理服务器层拦截客户端的请求，再重定向到自己的服务器） 

这时候我们需要一个权威的第三方机构（CA）确认这一个公钥确实是真实的服务器的公钥，服务器将自己的公钥和一些私人信息发给 CA，CA 用自己的私钥将这些数据加密之后就是数字证书（SSL证书）。  
当服务器向客户端发送数据的时候，还附带上从 CA 下载到本地的证书，客户端拿到证书以后使用CA的公钥进行解密，确认服务器的公钥无误

![](https://image.newarea.site/2024-02-18-23-40-10.png)

4.1、首先，客户端向服务器发出加密请求。

4.2、服务器用自己的私钥加密网页以后，连同本身的数字证书，一起发送给客户端。

4.3、客户端（浏览器）的"证书管理器"，有"受信任的根证书颁发机构"列表。客户端会根据这张列表，查看解开数字证书的公钥是否在列表之内。

4.4、如果数字证书记载的网址，与你正在浏览的网址不一致，就说明这张证书可能被冒用，浏览器会发出警告。

4.5、如果这张数字证书不是由受信任的机构颁发的，浏览器会发出另一种警告。

4.6、如果数字证书是可靠的，客户端就可以使用证书中的服务器公钥，对信息进行加密，然后与服务器交换加密信息。

  
refer：

[What is a Digital Signature?](http://www.youdzone.com/signature.html "What is a Digital Signature?")

[【信息安全】RSA-数字签名-数字证书\_weilin.jiang的博客-CSDN博客\_数字证书 rsa](https://blog.csdn.net/Jammg/article/details/51884431 "【信息安全】RSA-数字签名-数字证书_weilin.jiang的博客-CSDN博客_数字证书 rsa")

[RSA与SSL浅析\_codeLeaves的博客-CSDN博客\_rsa ssl](https://blog.csdn.net/laughing2333/article/details/52292481 "RSA与SSL浅析_codeLeaves的博客-CSDN博客_rsa ssl")